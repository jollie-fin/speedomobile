#ifndef IMU20948DEF_H
#define IMU20948DEF_H
#include <cstdint>

#define BIT(shift) (1u << (shift))

#define GENMASK(h, l) (((1u << ((h) - (l) + 1u)) - 1u) << (l))

#define ICM20948_CHIP_ID 0xEA

#define ICM20948_BANK_SEL_MASK GENMASK(5, 3)

#define ICM20948_BANK_PAGE_SIZE 0x1000
#define ICM20948_BANK_SEL_SHIFT 4

/* User bank 0 (MSB 0x00) */
#define ICM20948_WHOAMI 0x0000
#define ICM20948_USER_CTRL 0x0003
#define ICM20948_USER_CTRL_I2C_MST_EN_MASK BIT(5)
#define ICM20948_USER_CTRL_I2C_MST_EN(_mode) ((_mode) << 5)
#define ICM20948_USER_CTRL_I2C_IF_DIS(_mode) ((_mode) << 4)

#define ICM20948_LP_CONFIG 0x0005
#define ICM20948_PWR_MGMT_1 0x0006
#define ICM20948_PWR_MGMT_1_TEMP_MASK GENMASK(3, 3)
#define ICM20948_PWR_MGMT_1_CLKSEL(_mode) ((_mode) << 0)
#define ICM20948_PWR_MGMT_1_DEVICE_RESET(_mode) ((_mode) << 7)

#define ICM20948_PWR_MGMT_2 0x0007
#define ICM20948_PWR_MGMT_2_GYRO_MASK GENMASK(5, 3)
#define ICM20948_PWR_MGMT_2_GYRO(_mode) (((_mode) ? 0b111 : 0b0) << 3)
#define ICM20948_PWR_MGMT_2_ACCEL_MASK GENMASK(2, 0)
#define ICM20948_PWR_MGMT_2_ACCEL(_mode) ((_mode) ? 0b111 : 0b0)

#define ICM20948_INT_PIN_CFG 0x000F
#define ICM20948_INT_PIN_CFG_INT1_ACTL(_mode) \
    ((_mode) << 7)
#define ICM20948_INT_PIN_CFG_INT1_OPEN(_mode) \
    ((_mode) << 6)
#define ICM20948_INT_PIN_CFG_INT1_LATCH__EN(_mode) \
    ((_mode) << 5)
#define ICM20948_INT_PIN_CFG_INT_ANYRD_2CLEAR(_mode) \
    ((_mode) << 4)
#define ICM20948_INT_PIN_CFG_ACTL_FSYNC(_mode) \
    ((_mode) << 3)
#define ICM20948_INT_PIN_CFG_FSYNC_INT_MODE_EN(_mode) \
    ((_mode) << 2)
#define ICM20948_INT_PIN_CFG_BYPASS_EN(_mode) \
    ((_mode) << 1)

#define ICM20948_INT_ENABLE 0x0010

#define ICM20948_INT_ENABLE_1 0x0011

#define ICM20948_INT_ENABLE_2 0x0012

#define ICM20948_INT_ENABLE_3 0x0013
#define ICM20948_INT_ENABLE_3_FIFO BIT(0)

#define ICM20948_I2C_MST_STATUS 0x0017
#define ICM20948_INT_STATUS 0x0019
#define ICM20948_INT_STATUS_1 0x001A
#define ICM20948_INT_STATUS_2 0x001B
#define ICM20948_INT_STATUS_3 0x001C
#define ICM20948_DELAY_TIME_H 0x0028
#define ICM20948_DELAY_TIME_L 0x0029

/* all sensor data are 16 bits (2 registers wide) in big-endian */
#define ICM20948_ACCEL_XOUT 0x002D
#define ICM20948_ACCEL_YOUT 0x002F
#define ICM20948_ACCEL_ZOUT 0x0031
#define ICM20948_GYRO_XOUT 0x0033
#define ICM20948_GYRO_YOUT 0x0035
#define ICM20948_GYRO_ZOUT 0x0037
#define ICM20948_TEMP_OUT 0x0039

#define ICM20948_EXT_SLV_SENS_DATA_00 0x003b
#define ICM20948_EXT_SLV_SENS_DATA_01 0x003c
#define ICM20948_EXT_SLV_SENS_DATA_02 0x003d
#define ICM20948_EXT_SLV_SENS_DATA_03 0x003e
#define ICM20948_EXT_SLV_SENS_DATA_04 0x003f
#define ICM20948_EXT_SLV_SENS_DATA_05 0x0040
#define ICM20948_EXT_SLV_SENS_DATA_06 0x0041
#define ICM20948_EXT_SLV_SENS_DATA_07 0x0042
#define ICM20948_EXT_SLV_SENS_DATA_08 0x0043
#define ICM20948_EXT_SLV_SENS_DATA_09 0x0044
#define ICM20948_EXT_SLV_SENS_DATA_10 0x0045
#define ICM20948_EXT_SLV_SENS_DATA_11 0x0046
#define ICM20948_EXT_SLV_SENS_DATA_12 0x0047
#define ICM20948_EXT_SLV_SENS_DATA_13 0x0048
#define ICM20948_EXT_SLV_SENS_DATA_14 0x0049
#define ICM20948_EXT_SLV_SENS_DATA_15 0x004a
#define ICM20948_EXT_SLV_SENS_DATA_16 0x004b
#define ICM20948_EXT_SLV_SENS_DATA_17 0x004c
#define ICM20948_EXT_SLV_SENS_DATA_18 0x004d
#define ICM20948_EXT_SLV_SENS_DATA_19 0x004e
#define ICM20948_EXT_SLV_SENS_DATA_20 0x004f
#define ICM20948_EXT_SLV_SENS_DATA_21 0x0050
#define ICM20948_EXT_SLV_SENS_DATA_22 0x0051
#define ICM20948_EXT_SLV_SENS_DATA_23 0x0052

/* FIFO Slave */
#define ICM20948_FIFO_EN_1 0x0066

/* FIFO GYRO - ACCEL - TEMP */
#define ICM20948_FIFO_EN_2 0x0067
#define ICM20948_FIFO_EN_2_MASK GENMASK(5, 0)
#define ICM20948_FIFO_EN_2_ACCEL BIT(4)
#define ICM20948_FIFO_EN_2_GYRO_Z BIT(3)
#define ICM20948_FIFO_EN_2_GYRO_Y BIT(2)
#define ICM20948_FIFO_EN_2_GYRO_X BIT(1)
#define ICM20948_FIFO_EN_2_TEMP BIT(0)

#define ICM20948_FIFO_RST 0x0068
#define ICM20948_FIFO_MODE 0x0069
#define ICM20948_FIFO_COUNT 0x0070
#define ICM20948_FIFO_R_W 0x0072
#define ICM20948_DATA_READY_STATUS 0x0074

#define ICM20948_FIFO_CFG 0x0076
#define ICM20948_FIFO_CFG_STREAM 0x00
#define ICM20948_FIFO_CFG_SNAPSHOT 0x01

/* FIFO is 2048 bytes, let 12 samples for reading latency */
#define ICM20948_FIFO_WATERMARK_MAX (512 - 12 * 16)

/* user bank 1 */
#define ICM20948_SELF_TEST_X_GYRO 0x1002
#define ICM20948_SELF_TEST_Y_GYRO 0x1003
#define ICM20948_SELF_TEST_Z_GYRO 0x1004
#define ICM20948_SELF_TEST_X_ACCEL 0x100E
#define ICM20948_SELF_TEST_Y_ACCEL 0x100F
#define ICM20948_SELF_TEST_Z_ACCEL 0x1010
#define ICM20948_XA_OFFS_H 0x1014
#define ICM20948_XA_OFFS_L 0x1015
#define ICM20948_YA_OFFS_H 0x1017
#define ICM20948_YA_OFFS_L 0x1018
#define ICM20948_ZA_OFFS_H 0x101A
#define ICM20948_ZA_OFFS_L 0x101B
#define ICM20948_TIMEBASE_CORRECTION_PLL 0x1028

/* user bank 2 */
#define ICM20948_GYRO_SMPLRT_DIV 0x2000
#define ICM20948_GYRO_CONFIG_1 0x2001
#define ICM20948_GYRO_CONFIG_1_GYRO_DLPFCFG_MASK GENMASK(5, 3)
#define ICM20948_GYRO_CONFIG_1_GYRO_DLPFCFG(_mode) ((_mode) << 3)
#define ICM20948_GYRO_CONFIG_1_GYRO_FS_SEL_MASK GENMASK(2, 1)
#define ICM20948_GYRO_CONFIG_1_GYRO_FS_SEL(_mode) ((_mode) << 1)
#define ICM20948_GYRO_CONFIG_1_GYRO_FCHOICE_MASK GENMASK(0, 0)
#define ICM20948_GYRO_CONFIG_1_GYRO_FCHOICE(_mode) ((_mode))

#define ICM20948_GYRO_CONFIG_2 0x2002
#define ICM20948_GYRO_CONFIG_2_GYRO_AVGCFG_MASK GENMASK(1, 0)
#define ICM20948_GYRO_CONFIG_2_GYRO_AVGCFG(_mode) ((_mode))

#define ICM20948_XG_OFFS_USRH 0x2003
#define ICM20948_XG_OFFS_USRL 0x2004
#define ICM20948_YG_OFFS_USRH 0x2005
#define ICM20948_YG_OFFS_USRL 0x2006
#define ICM20948_ZG_OFFS_USRH 0x2007
#define ICM20948_ZG_OFFS_USRL 0x2008
#define ICM20948_ODR_ALIGN_EN 0x2009
#define ICM20948_ACCEL_SMPLRT_DIV_1 0x2010
#define ICM20948_ACCEL_SMPLRT_DIV_2 0x2011
#define ICM20948_ACCEL_INTEL_CTRL 0x2012
#define ICM20948_ACCEL_WOM_THR 0x2012

#define ICM20948_ACCEL_CONFIG 0x2014
#define ICM20948_ACCEL_CONFIG_ACCEL_DLPFCFG_MASK GENMASK(5, 3)
#define ICM20948_ACCEL_CONFIG_ACCEL_DLPFCFG(_mode) ((_mode) << 3)
#define ICM20948_ACCEL_CONFIG_ACCEL_FS_SEL_MASK GENMASK(2, 1)
#define ICM20948_ACCEL_CONFIG_ACCEL_FS_SEL(_mode) ((_mode) << 1)
#define ICM20948_ACCEL_CONFIG_ACCEL_FCHOICE_MASK GENMASK(0, 0)
#define ICM20948_ACCEL_CONFIG_ACCEL_FCHOICE(_mode) ((_mode))

#define ICM20948_ACCEL_CONFIG_2 0x2015
#define ICM20948_ACCEL_CONFIG_2_DEC3_CFG_MASK GENMASK(1, 0)
#define ICM20948_ACCEL_CONFIG_2_DEC3_CFG(_mode) ((_mode))

#define ICM20948_FSYNC_CONFIG 0x2052
#define ICM20948_TEMP_CONFIG 0x2053
#define ICM20948_MOD_CTRL_USR 0x2054

/* user bank 3 */
#define ICM20948_I2C_MST_ODR_CONFIG 0x3000
#define ICM20948_I2C_MST_CTRL 0x3001

#define ICM20948_I2C_MST_DELAY_CTRL 0x3002

#define ICM20948_I2C_SLV0_ADDR 0x3003
#define ICM20948_I2C_SLV0_ADDR_I2C_SLV0_RNW_MASK BIT(7)
#define ICM20948_I2C_SLV0_ADDR_I2C_SLV0_RNW(_mode) ((_mode) << 7)
#define ICM20948_I2C_SLV0_ADDR_I2C_ID_0_MASK GENMASK(7, 0)
#define ICM20948_I2C_SLV0_ADDR_I2C_ID_0(_mode) ((_mode))

#define ICM20948_I2C_SLV0_REG 0x3004
#define ICM20948_I2C_SLV0_CTRL 0x3005
#define ICM20948_I2C_SLV0_CTRL_I2C_SLV0_EN_MASK BIT(7)
#define ICM20948_I2C_SLV0_CTRL_I2C_SLV0_EN(_mode) ((_mode) << 7)
#define ICM20948_I2C_SLV0_CTRL_I2C_SLV0_GRP_MASK BIT(3)
#define ICM20948_I2C_SLV0_CTRL_I2C_SLV0_GRP(_mode) ((_mode) << 3)
#define ICM20948_I2C_SLV0_CTRL_I2C_SLV0_LENG_MASK GENMASK(3, 0)
#define ICM20948_I2C_SLV0_CTRL_I2C_SLV0_LENG(_mode) ((_mode))

#define ICM20948_I2C_SLV0_DO 0x3006
#define ICM20948_I2C_SLV1_ADDR 0x3007
#define ICM20948_I2C_SLV1_REG 0x3008
#define ICM20948_I2C_SLV1_CTRL 0x3009
#define ICM20948_I2C_SLV1_DO 0x300A
#define ICM20948_I2C_SLV2_ADDR 0x300B
#define ICM20948_I2C_SLV2_REG 0x300C
#define ICM20948_I2C_SLV2_CTRL 0x300D
#define ICM20948_I2C_SLV2_DO 0x300E
#define ICM20948_I2C_SLV3_ADDR 0x300F
#define ICM20948_I2C_SLV3_REG 0x3010
#define ICM20948_I2C_SLV3_CTRL 0x3011
#define ICM20948_I2C_SLV3_DO 0x3012
#define ICM20948_I2C_SLV4_ADDR 0x3013
#define ICM20948_I2C_SLV4_REG 0x3014
#define ICM20948_I2C_SLV4_CTRL 0x3015
#define ICM20948_I2C_SLV4_DO 0x3016
#define ICM20948_I2C_SLV4_DI 0x3017

#define ICM20948_REG_BANK_SEL 0x7F
#define ICM20948_MAX_REG ICM20948_REG_BANK_SEL

#define ICM20948_TEMP_OFFSET 21
#define ICM20948_TEMP_SENSITIVITY 333.87
#define ICM20948_ROOM_TEMP_OFFSET 21

#define ICM20948_POWER_UP_TIME_MS 100
#define ICM20948_RESET_TIME_MS 1
#define ICM20948_ACCEL_STARTUP_TIME_MS 20
#define ICM20948_GYRO_STARTUP_TIME_MS 60
#define ICM20948_GYRO_STOP_TIME_MS 150
#define ICM20948_TEMP_STARTUP_TIME_MS 14
#define ICM20948_SUSPEND_DELAY_MS 2000
#define ICM20948_DEVICE_CONFIG_SOFT_RESET 0x80
#define ICM20948_MAG_TRIGGER_TIME_MS 5
#define ICM20948_MAG_STARTUP_TIME_MS 1
#define ICM20948_MAG_READY_WAIT_US 10

#define AK09916_ADDR 0x0c
#define AK09916_CHIP_ID 0x09

#define AK09916_WIA1 0x00
#define AK09916_WIA2 0x01
#define AK09916_ST1 0x10
#define AK09916_HX 0x11
#define AK09916_HY 0x13
#define AK09916_HZ 0x15
#define AK09916_TEMPS 0x17
#define AK09916_ST2 0x18
#define AK09916_CNTL2 0x31
#define AK09916_CNTL3 0x32
#define AK09916_CNTL3_SOFT_RESET 0x01
#define AK09916_TS1 0x33
#define AK09916_TS2 0x34

#endif